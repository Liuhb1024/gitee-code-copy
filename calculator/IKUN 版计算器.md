# IKUN 版计算器



## change函数

```cpp
void Change(char c1[])//将中缀表达式转换为后缀表达式并进行计算 
{
	fflush(stdin); //清空输入缓存区 
	int count = 0;
	int i;
	int j;
	int m;
	int n;
	int top = 0;
	int v = -1;//为栈空 
	//int u=0;
	int k = strlen(c1);
	int r = fun(c1, 0, k - 1);
	if (r != 1)
	{
		printf("  括号不匹配，请重新输入 ：\n");
	loop:
		input();
		if (*c1 == 'E')
		{
			main();//返回主函数 
		}
		else
		{
			Change(c1);
		}
	}
	else
	{
		for (i = 0; i < k; i++)//对输入的数组进行后缀表达式转换	
		{
			switch (c1[i])
			{
			case '(':
				c2[++top] = c1[i];
				break;
			case '+':
			case '-':
				while (top > 0 && c2[top] != '(')//判断栈顶的元素是否为括号，且栈不空时 ，将栈中的前两个元素进行出栈与运算，将运算的结果进行重新入栈  
				{
					c3[++v] = c2[top];
					c3[++v] = ' ';  //空格 
					top--;
				}
				c2[++top] = c1[i]; //当栈空或者遇到(时，将"-"直接入栈 
				break;
			case '*':
			case '/':
				while (top > 0 && c2[top] != '(' && c2[top] != '+' && c2[top] != '-')//考虑优先级
				{
					c3[++v] = c2[top];
					c3[++v] = ' ';
					top--;
				}
				c2[++top] = c1[i];
				break;
			case '%':
				while (top > 0 && c2[top] != '(' && c2[top] != '+' && c2[top] != '-')//考虑优先级
				{
					c3[++v] = c2[top];
					c3[++v] = ' ';
					top--;
				}
				c2[++top] = c1[i];
				break;
			case '^':
				while (top > 0 && c2[top] != '(' && c2[top] != '+' && c2[top] != '-')//考虑优先级
				{
					c3[++v] = c2[top];
					c3[++v] = ' ';
					top--;
				}
				c2[++top] = c1[i];
				break;
			case '!':
				while (top > 0 && c2[top] != '(' && c2[top] != '+' && c2[top] != '-')//考虑优先级 
				{
					c3[++v] = c2[top];
					c3[++v] = ' ';
					top--;
				}
				c2[++top] = c1[i];
				break;
			case ')':
				while (c2[top] != '(') {
					c3[++v] = c2[top];
					c3[++v] = ' ';
					top--;
				}
				top--;
				break;
			default:
				c3[++v] = c1[i];
				if (c1[i + 1] > '9' || c1[i + 1] < '0')
					c3[++v] = ' ';
				break;
			}
		}
		while (top > 0 && c2[top] != '(')
		{
			c3[++v] = c2[top];
			c3[++v] = ' ';
			top--;
		}
		cout << "它的后缀表达式是：" << endl;
		puts(c3);
		top = 0;
		float sum;
		k = strlen(c3);
		for (i = 0; i < k; i++)
		{
			if (c3[i] == ' ')
			{
				;
			}
			else if (c3[i] == '+')
			{
				sum = a[top - 1] + a[top];
				a[--top] = sum;
			}
			else if (c3[i] == '-')
			{
				sum = a[top - 1] - a[top];
				a[--top] = sum;
			}
			else if (c3[i] == '*')
			{
				sum = a[top - 1] * a[top];
				a[--top] = sum;
			}
			else if (c3[i] == '/')
			{
				if (a[top] == 0)
				{
					cout << "  输入错误，被除数不能为0，请重新输入  ：" << endl;
					goto loop; 	//跳到程序指定的地方 
				}
				else
				{
					sum = a[top - 1] / a[top];
					a[--top] = sum;
				}
			}
			else if (c3[i] == '%')
			{
				if (a[top] == 0)
				{
					cout << "  输入错误，被取余数不能为0，请重新输入  ：" << endl;
					goto loop;
				}
				else
				{
					int sum1 = a[top - 1] * 10;
					int sum2 = a[top] * 10;
					sum = (sum1 % sum2) / 10;
					a[--top] = sum;
				}
			}
			else if (c3[i] == '^')
			{
				sum = pow(a[top - 1], a[top]);
				a[--top] = sum;
			}
			else if (c3[i] == '!')
			{
				if (a[top] < 0)
				{
					cout << "  输入错误，负数没有阶乘，请重新输入 ：" << endl;//提示信息，并重新输入
					input();
					goto loop;
				}
				else
				{
					float sum = 1;
					for (int j = 1; j <= a[top]; j++)
					{
						sum = sum * j;
					}
					a[top] = sum;
				}
			}
			else
			{
				int m = 0;
				while (c3[i] >= '0' && c3[i] <= '9')
				{
					m = 10 * m + c3[i] - '0';
					i++;
				}
				a[++top] = m;
			}
		}
		PrintList(top, a);
	}
}
```



1. `void Change(char c1[])`：这是一个函数的定义，接受一个字符数组 `c1` 作为参数，并且没有返回值。
2. `fflush(stdin);`：清空输入缓冲区
3. 变量的定义：
   - `count`：计数器
   - `i`、`j`、`m`、`n`：循环变量
   - `top`：栈顶指针
   - `v`：后缀表达式数组 `c3` 的索引
   - `k`：输入中缀表达式的长度
   - `r`：用于检查括号匹配的结果，`fun` 是一个函数（在代码中未给出）用于检查括号匹配
   - `a`：用于存储计算后缀表达式的结果
4. 检查括号匹配：
   - 如果括号不匹配，则输出提示信息并要求重新输入。
   - 如果括号匹配，则继续执行后续代码。
5. 将中缀表达式转换为后缀表达式：
   - 使用`switch`语句对输入的字符进行判断：
     - 如果是 `'('`，将其入栈
     - 如果是 `'+'` 或 `'-''`，当栈不为空且栈顶元素不是 `'('` 时，将栈顶元素出栈并加入到后缀表达式数组 `c3` 中，然后将 `'+'` 或 `'-'` 入栈
     - 如果是 `'*'`、`'/'`、`'%'`、`'^'` 或 `'!'`，当栈不为空且栈顶元素不是 `'('`、`'+'` 或 `'-'` 时，将栈顶元素出栈并加入到后缀表达式数组 `c3` 中，然后将当前字符入栈
     - 如果是 `')'`，将栈顶元素出栈并加入到后缀表达式数组 `c3` 中，直到遇到 `'('`，然后将 `'('` 出栈
     - 其他情况，将当前字符加入到后缀表达式数组 `c3` 中
6. 输出后缀表达式：
   - 使用 `cout` 输出提示信息 "它的后缀表达式是："，然后使用 `puts` 输出后缀表达式数组 `c3`。
7. 计算后缀表达式：
   - 遍历后缀表达式数组`c3`：
     - 如果当前字符是空格，则跳过
     - 如果当前字符是 `'+'`，从栈中取出两个数字进行相加，并将结果入栈
     - 如果当前字符是 `'-'`，从栈中取出两个数字进行相减，并将结果入栈
     - 如果当前字符是 `'*'`，从栈中取出两个数字进行相乘，并将结果入栈
     - 如果当前字符是 `'/'`，从栈中取出两个数字进行相除（注意处理被除数为0的情况），并将结果入栈
     - 如果当前字符是 `'%'`，从栈中取出两个数字进行取余（注意处理被取余数为0的情况），并将结果入栈
     - 如果当前字符是 `'^'`，从栈中取出两个数字进行幂运算，并将结果入栈
     - 如果当前字符是 `'!'`，对栈顶的数字进行阶乘运算，并将结果入栈
     - 如果当前字符是数字字符，则将连续的数字字符转换为整数，并将结果入栈
8. 输出计算结果：
   - 调用 `PrintList` 函数输出栈中最终的计算结果。